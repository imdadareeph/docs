<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Spring Data Neo4j | Mr. Imdad Areeph</title> <meta name="author" content="Imdad Areeph"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/docs/assets/img/favicon.ico"> <link rel="stylesheet" href="/docs/assets/css/main.css"> <link rel="canonical" href="https://imdadareeph.github.io/docs/api/docs/db/db-neo4j/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/docs/assets/js/theme.js"></script> <script src="/docs/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/docs/">Mr. Imdad Areeph</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/docs/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/docs/teaching/">teaching</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">api-docs</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/docs/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/docs/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/docs/api/docs/db-reactive/">db-reactive</a> <a class="dropdown-item" href="/docs/api/docs/db/db-intro/">db-intro</a> <a class="dropdown-item" href="/docs/api/docs/db/db-cassandra/">db-cassandra</a> <a class="dropdown-item" href="/docs/api/docs/db/db-elasticsearch/">db-elasticsearch</a> <a class="dropdown-item" href="/docs/api/docs/db-neo4j-rx/">db-neo4j-rx</a> <a class="dropdown-item" href="/docs/api/docs/db/db-neo4j/">db-neo4j</a> <a class="dropdown-item" href="/docs/api/docs/db/db-r2dbc/">db-r2dbc</a> <a class="dropdown-item" href="/docs/api/docs/db/db-redis/">db-redis</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <h1 id="spring-data-neo4j">Spring Data Neo4j</h1> <blockquote> <p>The effort of <a href="https://github.com/neo4j/sdn-rx/" rel="external nofollow noopener" target="_blank">Spring Data Neo4j RX</a> has been merged into the official Spring Data Neo4j project since Spring Data Neo4j 6.0. If you are using SDN Rx it is better to upgrade to the official Spring Data Neo4j.</p> </blockquote> <blockquote> <p>This post targets Spring Data Neo4j 6.0 GA and Spring Boot 2.4.x release.</p> </blockquote> <h2 id="getting-started">Getting Started</h2> <p>Firstly, generate a Spring WebFlux project skeleton using <a href="https://start.spring.io" rel="external nofollow noopener" target="_blank">Spring initializr</a>.</p> <ul> <li>Choose Maven as project type(If you prefer Gradle, choose Gradle please)</li> <li>And select Spring Boot 2.4.3</li> <li>And select Java 11 or Java 15, personally I would like use the latest Java to experience the upcoming preview features</li> <li>Add the following dependencies. <ul> <li>Data Neo4j</li> <li>Web Reactive</li> <li>Lombok</li> </ul> </li> </ul> <p>Extract the downloaded archive into your disc, and import into your IDEs</p> <p>Open the <code class="language-plaintext highlighter-rouge">pom.xml</code> file in the project root, you will see the following dependencies added in the <em>dependencies</em> section.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-neo4j<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-webflux<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>io.projectreactor<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>reactor-test<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div> <p>Now , create a Noe4j entity class as the following.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Node</span>
<span class="nd">@Data</span>
<span class="nd">@ToString</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>A Neo4j entity is annotated with a <code class="language-plaintext highlighter-rouge">@Node</code> annotation.</p> <blockquote> <p>We used the <code class="language-plaintext highlighter-rouge">@Data</code>, <code class="language-plaintext highlighter-rouge">@ToString</code>, <code class="language-plaintext highlighter-rouge">@Builder</code> annotations provided in Lombok to erases the tedious methods, such as setters, getters, hashCode, equals, and toString in a POJO class.</p> </blockquote> <p>Create a <code class="language-plaintext highlighter-rouge">Repository</code> for the <code class="language-plaintext highlighter-rouge">Post</code> entity.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">ReactiveNeo4jRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div> <p>Create a <code class="language-plaintext highlighter-rouge">RestController</code> to expose the simple CRUD RESTful APIs for the <code class="language-plaintext highlighter-rouge">Post</code> entity.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="o">()</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/posts"</span><span class="o">)</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">class</span> <span class="nc">PostController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PostRepository</span> <span class="n">posts</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">all</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">""</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">get</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">posts:</span><span class="o">:</span><span class="n">findById</span><span class="o">)</span>
                <span class="o">.</span><span class="na">switchIfEmpty</span><span class="o">(</span><span class="nc">Mono</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="k">new</span> <span class="nc">PostNotFoundException</span><span class="o">(</span><span class="n">id</span><span class="o">)));</span>
    <span class="o">}</span>

    <span class="nd">@PutMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">update</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="n">p</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
                    <span class="n">p</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getContent</span><span class="o">());</span>

                    <span class="k">return</span> <span class="n">p</span><span class="o">;</span>
                <span class="o">})</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">::</span><span class="n">save</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p>In the above <code class="language-plaintext highlighter-rouge">get</code> method, when the post is not found it will throw a <code class="language-plaintext highlighter-rouge">PostNotFoundException</code>. Create a <code class="language-plaintext highlighter-rouge">@RestControllerAdvice</code> annotated class to handle this exception.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestControllerAdvice</span>
<span class="nd">@Slf4j</span>
<span class="kd">class</span> <span class="nc">RestExceptionHandler</span> <span class="o">{</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="nc">PostNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="nc">ResponseEntity</span> <span class="nf">postNotFound</span><span class="o">(</span><span class="nc">PostNotFoundException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"handling exception::"</span> <span class="o">+</span> <span class="n">ex</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">notFound</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p>Add a <code class="language-plaintext highlighter-rouge">ReactiveTransactionManager</code> bean. In the Spring Data Neo4j 6.0, it seems activating a reactive transaction manager becomes a must, if it is not set, you will see an exception thrown at the startup stage when running the application.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// see: https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.4.0-M2-Release-Notes#neo4j-1</span>
<span class="nd">@Bean</span><span class="o">(</span><span class="nc">ReactiveNeo4jRepositoryConfigurationExtension</span><span class="o">.</span><span class="na">DEFAULT_TRANSACTION_MANAGER_BEAN_NAME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ReactiveTransactionManager</span> <span class="nf">reactiveTransactionManager</span><span class="o">(</span>
    <span class="nc">Driver</span> <span class="n">driver</span><span class="o">,</span>
    <span class="nc">ReactiveDatabaseSelectionProvider</span> <span class="n">databaseNameProvider</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ReactiveNeo4jTransactionManager</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="n">databaseNameProvider</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <blockquote> <p>NOTE: If you are from SDN Rx, adding a transaction manager is a must now.</p> </blockquote> <p>Add a <code class="language-plaintext highlighter-rouge">CommandLineRunner</code> bean to initialize some sample data. Here we use <code class="language-plaintext highlighter-rouge">PostRepository</code> to insert two <code class="language-plaintext highlighter-rouge">Post</code> sample data.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">class</span> <span class="nc">DataInitializer</span> <span class="kd">implements</span> <span class="nc">CommandLineRunner</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PostRepository</span> <span class="n">posts</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"start data initialization..."</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">thenMany</span><span class="o">(</span>
                        <span class="nc">Flux</span>
                                <span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">,</span> <span class="s">"Post two"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span>
                                        <span class="n">title</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">title</span><span class="o">(</span><span class="n">title</span><span class="o">).</span><span class="na">content</span><span class="o">(</span><span class="s">"The content of "</span> <span class="o">+</span> <span class="n">title</span><span class="o">).</span><span class="na">build</span><span class="o">())</span>
                                <span class="o">)</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">log</span><span class="o">()</span>
                <span class="o">.</span><span class="na">thenMany</span><span class="o">(</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">findAll</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"[Initializing data]"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span>
                        <span class="n">data</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"found post: {}"</span><span class="o">,</span> <span class="n">data</span><span class="o">),</span>
                        <span class="n">err</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"error"</span><span class="o">,</span> <span class="n">err</span><span class="o">),</span>
                        <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"done"</span><span class="o">)</span>
                <span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p>Before starting this application, make sure there is a running Neo4j server.</p> <p>There is a <em>docker-compose.yaml</em> file in the root folder of the <a href="https://github.com/imdadareeph/reactive-spring" rel="external nofollow noopener" target="_blank">reactive-spring</a> repository which is prepared for bootstrapping dependent servers.</p> <p>Simply, run the following command to serve a Neo4j instance in the Docker container.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up neo4j
</code></pre></div></div> <p>And do not forget to configure the connection settings in the <em>application.properties</em>.</p> <div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.neo4j.uri</span><span class="p">=</span><span class="s">bolt://localhost:7687</span>
<span class="py">spring.neo4j.authentication.username</span><span class="p">=</span><span class="s">neo4j</span>
<span class="py">spring.neo4j.authentication.password</span><span class="p">=</span><span class="s">test</span>
</code></pre></div></div> <blockquote> <p>Note: if you are migrating from <a href="https://github.com/neo4j/sdn-rx/" rel="external nofollow noopener" target="_blank">SDN RX</a>, you need to replace all namespaces with the new <code class="language-plaintext highlighter-rouge">spring.neo4j</code> prefix.</p> </blockquote> <p>Now, you can run the application directly in IDEs, or using the following Maven command.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn spring-boot:run
</code></pre></div></div> <p>After it run successfully, try to use <code class="language-plaintext highlighter-rouge">curl</code> command to verify the exposed APIs.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># curl http://localhost:8080/posts</span>
<span class="o">[{</span><span class="s2">"id"</span>:0,<span class="s2">"title"</span>:<span class="s2">"Post two"</span>,<span class="s2">"content"</span>:<span class="s2">"The content of Post two"</span>,<span class="s2">"createdDate"</span>:<span class="s2">"2020-11-04T10:35:14.1619567"</span>,<span class="s2">"updatedDate"</span>:<span class="s2">"2020-11-04T10:35:14.1619567"</span>,<span class="s2">"createdBy"</span>:<span class="s2">"imdadareeph"</span>,<span class="s2">"updatedBy"</span>:<span class="s2">"imdadareeph"</span><span class="o">}</span>,<span class="o">{</span><span class="s2">"id"</span>:1,<span class="s2">"title"</span>:<span class="s2">"Post one"</span>,<span class="s2">"content"</span>:<span class="s2">"The content of Post one"</span>,<span class="s2">"createdDate"</span>:<span class="s2">"2020-11-04T10:35:14.1481498"</span>,<span class="s2">"updatedDate"</span>:<span class="s2">"2020-11-04T10:35:14.1481498"</span>,<span class="s2">"createdBy"</span>:<span class="s2">"imdadareeph"</span>,<span class="s2">"updatedBy"</span>:<span class="s2">"imdadareeph"</span><span class="o">}]</span>
</code></pre></div></div> <p>For the complete codes, check <a href="https://github.com/imdadareeph/reactive-spring/blob/master/boot-data-neo4j" rel="external nofollow noopener" target="_blank">reactive-spring/boot-data-neo4j</a>.</p> <h2 id="customizing-queries">Customizing Queries</h2> <p>Like other Spring Data modules, Spring Data Neo4j also supports derived query methods.</p> <p>For example, to find the posts by keyword that matches the title field, add the following method in the <code class="language-plaintext highlighter-rouge">PostRepository</code> interface.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">ReactiveNeo4jRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByTitleLike</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <p>Add a new test method in <code class="language-plaintext highlighter-rouge">PostRespositoryTest</code> to verify it.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">testFindByTitle</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">posts</span><span class="o">.</span><span class="na">findByTitleLike</span><span class="o">(</span><span class="s">"one"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="nl">StepVerifier:</span><span class="o">:</span><span class="n">create</span><span class="o">)</span>
        <span class="o">.</span><span class="na">consumeNextWith</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">verifyComplete</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>Run the test, it should work as expected.</p> <p>Alternatively, you can use a <code class="language-plaintext highlighter-rouge">@Query</code> annotation to execute Cypher Query Language.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.data.neo4j.repository.query.Query</span><span class="o">;</span>
<span class="c1">//...</span>
    
<span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">ReactiveNeo4jRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"MATCH(post:Post) WHERE post.title =~ $title RETURN post"</span><span class="o">)</span>
    <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByTitleContains</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">);</span>
    
    <span class="c1">//</span>
	<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div> <p>Here we use a <code class="language-plaintext highlighter-rouge">regex</code> pattern in the where clause.</p> <blockquote> <p>More details about the syntax of Cypher Query Language, please check the <a href="https://neo4j.com/developer/cypher/" rel="external nofollow noopener" target="_blank">official Neo4j documentation</a>.</p> </blockquote> <p>Add a test method to verify it.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">testFindByQuery</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">posts</span><span class="o">.</span><span class="na">findByTitleContains</span><span class="o">(</span><span class="s">"(?i).*"</span> <span class="o">+</span> <span class="s">"one"</span> <span class="o">+</span> <span class="s">".*"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="nl">StepVerifier:</span><span class="o">:</span><span class="n">create</span><span class="o">)</span>
        <span class="o">.</span><span class="na">consumeNextWith</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">verifyComplete</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>Here the <code class="language-plaintext highlighter-rouge">findByTitleContains</code> method has to accept a Regex pattern.</p> <h2 id="reactiveneo4jclient">ReactiveNeo4jClient</h2> <p>Once Spring Data Neo4j is configured in a reactive application, a <code class="language-plaintext highlighter-rouge">ReactvieNeo4jClient</code> bean is available in the Spring application context.</p> <p>Like the R2dbc’s <code class="language-plaintext highlighter-rouge">DatabaseClient</code> , with <code class="language-plaintext highlighter-rouge">ReactiveNeo4jClient</code>, you can execute custom Cypher Queries and handle returning result freely.</p> <p>For example, to find all posts, it can be done by the following method.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
        MATCH (p:Post)
        RETURN p.id as id, p.title as title, p.content as content, p.createdAt as createdAt, p.updatedAt as updatedAt
        """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span>
        <span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
        <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
                                      <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                      <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                                      <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                      <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                      <span class="o">.</span><span class="na">createdAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"createdAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                      <span class="o">.</span><span class="na">updatedAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                      <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                                     <span class="o">)</span>
        <span class="o">.</span><span class="na">all</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <p>In the above codes.</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">query</code> use a multi-lined text block(available in the latest Java 15) to define a Cypher query.</li> <li>The <code class="language-plaintext highlighter-rouge">client.query</code> to execute the defined query.</li> <li>The <code class="language-plaintext highlighter-rouge">fetchAs</code> to handle the returning result, similar to RowMapper in Jdbc/R2dbc to extract the result and wrap it into a POJO class.</li> <li>The <code class="language-plaintext highlighter-rouge">all</code> will return a <code class="language-plaintext highlighter-rouge">Flux</code> , if you want to return a single result, use <code class="language-plaintext highlighter-rouge">one</code> instead.</li> </ul> <p>The following is an example of basic CRUD operations.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepository</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ReactiveNeo4jClient</span> <span class="n">client</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">count</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (p:Post) RETURN count(p)
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                <span class="o">.</span><span class="na">one</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (p:Post)
                RETURN p.id as id, p.title as title, p.content as content, p.createdAt as createdAt, p.updatedAt as updatedAt
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span>
                <span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
                        <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">createdAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"createdAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">updatedAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">all</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByTitleContains</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (p:Post)
                WHERE p.title =~ $title
                RETURN p.id as id, p.title as title, p.content as content, p.createdAt as createdAt, p.updatedAt as updatedAt
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span>
                <span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="s">"(?!).*"</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">".*"</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="s">"title"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
                        <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">createdAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"createdAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">updatedAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">all</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (p:Post)
                WHERE p.id = $id
                RETURN p.id as id, p.title as title, p.content as content, p.createdAt as createdAt, p.updatedAt as updatedAt
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span>
                <span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
                        <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">createdAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"createdAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">updatedAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">one</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MERGE (p:Post {id: $id})
                ON CREATE SET p.createdAt=localdatetime(), p.title=$title, p.content=$content
                ON MATCH SET p.updatedAt=localdatetime(), p.title=$title, p.content=$content
                RETURN p.id as id, p.title as title, p.content as content, p.createdAt as createdAt, p.updatedAt as updatedAt
                """</span><span class="o">;</span>

        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="n">data</span> <span class="o">-&gt;</span>
                        <span class="nc">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                                <span class="s">"id"</span><span class="o">,</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">data</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">:</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">()),</span>
                                <span class="s">"title"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">getTitle</span><span class="o">(),</span>
                                <span class="s">"content"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">getContent</span><span class="o">()</span>
                        <span class="o">)</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">fetchAs</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">mappedBy</span><span class="o">((</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span>
                        <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">).</span><span class="na">asLong</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"content"</span><span class="o">).</span><span class="na">asString</span><span class="o">())</span>
                                <span class="o">.</span><span class="na">createdAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"createdAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">updatedAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"updatedAt"</span><span class="o">).</span><span class="na">asLocalDateTime</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
                                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">one</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">deleteAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (m:Post) DETACH DELETE m
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">run</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">.</span><span class="na">counters</span><span class="o">().</span><span class="na">nodesDeleted</span><span class="o">());</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">deleteById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">query</span> <span class="o">=</span> <span class="sh">"""
                MATCH (p:Post) WHERE p.id = $id
                DETACH DELETE p
                """</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">client</span>
                <span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
                <span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">run</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="n">it</span><span class="o">.</span><span class="na">counters</span><span class="o">().</span><span class="na">nodesDeleted</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <p>For the complete codes, check <a href="https://github.com/imdadareeph/reactive-spring/blob/master/boot-neo4j-cypher" rel="external nofollow noopener" target="_blank">reactive-spring/boot-neo4j-cypher</a>.</p> <h2 id="reactiveneo4joperations">ReactiveNeo4jOperations</h2> <p>Like other Spring Data modules, Spring Data Neo4j provides a <code class="language-plaintext highlighter-rouge">ReactiveNeo4jOperations</code>(and the implementation <code class="language-plaintext highlighter-rouge">ReactiveNeo4jTemplate</code>), it allows your to perform operations on Neo4j databases but by programmatic approaches.</p> <p>Here is an example of <code class="language-plaintext highlighter-rouge">PostRepository</code> which is reimplemented by <code class="language-plaintext highlighter-rouge">ReactiveNeo4jOperations</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepository</span>  <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ReactiveNeo4jOperations</span> <span class="n">template</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="nf">count</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByTitleContains</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">postNode</span> <span class="o">=</span> <span class="n">node</span><span class="o">(</span><span class="s">"Post"</span><span class="o">).</span><span class="na">named</span><span class="o">(</span><span class="s">"p"</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span>
                <span class="n">match</span><span class="o">(</span><span class="n">postNode</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">postNode</span><span class="o">.</span><span class="na">property</span><span class="o">(</span><span class="s">"title"</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">literalOf</span><span class="o">(</span><span class="n">title</span><span class="o">)))</span>
                        <span class="o">.</span><span class="na">returning</span><span class="o">(</span><span class="n">postNode</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">build</span><span class="o">(),</span>
                <span class="nc">Post</span><span class="o">.</span><span class="na">class</span>
        <span class="o">);</span>
    <span class="o">}</span>



    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">save</span><span class="o">(</span><span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">saveAll</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">saveAll</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">deleteById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">deleteAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">template</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <p>It it similar to the ReactiveNeo4jClient, but more simple. Have a look at the <code class="language-plaintext highlighter-rouge">findAll</code>, the literal queries are replaced by Java Query Criteria APIs.</p> <p>For the complete codes, check <a href="https://github.com/imdadareeph/reactive-spring/blob/master/boot-neo4j" rel="external nofollow noopener" target="_blank">reactive-spring/boot-neo4j</a>.</p> <h2 id="data-auditing-support">Data Auditing Support</h2> <p>Change the original <code class="language-plaintext highlighter-rouge">Post</code> entity, add the following fields to capture the timestamp and auditor when saving and updating the entity.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Node</span>
<span class="nd">@Data</span>
<span class="nd">@ToString</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">class</span> <span class="nc">Post</span> <span class="o">{</span>

	<span class="c1">//...</span>

    <span class="nd">@CreatedDate</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdDate</span><span class="o">;</span>

    <span class="nd">@LastModifiedDate</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">updatedDate</span><span class="o">;</span>

    <span class="nd">@CreatedBy</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">createdBy</span><span class="o">;</span>

    <span class="nd">@LastModifiedBy</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">updatedBy</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div> <p>In the above codes, there are some annotations applied on the fields.</p> <ul> <li> <code class="language-plaintext highlighter-rouge">CreatedDate</code> will fill the current date when saving the entity.</li> <li> <code class="language-plaintext highlighter-rouge">LastModifiedDate</code> will fill the current date when updating the entity.</li> <li> <code class="language-plaintext highlighter-rouge">CreatedBy</code> will retrieve the current auditor from <code class="language-plaintext highlighter-rouge">ReactiveAuditorAware</code> and fill it when saving the entity.</li> <li> <code class="language-plaintext highlighter-rouge">LastModifiedBy</code> will retrieve the current auditor from <code class="language-plaintext highlighter-rouge">ReactiveAuditorAware</code> and fill it when updating the entity.</li> </ul> <p>The <code class="language-plaintext highlighter-rouge">CreatedDate</code> and <code class="language-plaintext highlighter-rouge">LastModifiedDate</code> can be applied on the traditional <code class="language-plaintext highlighter-rouge">java.util.Date</code>, the new Java 8 DateTime API and <a href="https://www.joda.org" rel="external nofollow noopener" target="_blank">Joda</a> time types.</p> <p>The class type of <code class="language-plaintext highlighter-rouge">CreatedBy</code> and <code class="language-plaintext highlighter-rouge">ModifiedBy</code> are dependent on the parameterized type of the declaration of <code class="language-plaintext highlighter-rouge">ReactiveAuditorAware</code> bean.</p> <p>Add a <code class="language-plaintext highlighter-rouge">ReactiveAuditorAware</code> bean to serve the auditor in the entity when saving and updating it.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">ReactiveAuditorAware</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">reactiveAuditorAware</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="s">"imdadareeph"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div> <blockquote> <p>Note : in the real world applications, you can retrieve the current user from current SecurityContextHolder.</p> </blockquote> <p>By default Spring Boot do not autoconfigure the auditing feature. Do not forget to add a <code class="language-plaintext highlighter-rouge">@EnableReactiveNeo4jAuditing</code> annotation on the <code class="language-plaintext highlighter-rouge">@Configuration</code> class to activate the data auditing feature.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span><span class="o">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@EnableReactiveNeo4jAuditing</span>
<span class="kd">class</span> <span class="nc">DataConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">ReactiveAuditorAware</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">reactiveAuditorAware</span><span class="o">()</span> <span class="o">{...</span> <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>Run the application, you will see the following logging info printed by the <code class="language-plaintext highlighter-rouge">DataInitializer</code> bean.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2020-11-08 10:22:26.661  INFO 16856 <span class="nt">---</span> <span class="o">[</span>o4jDriverIO-2-2] <span class="o">[</span>Initializing data]                      : onNext<span class="o">(</span>Post<span class="o">(</span><span class="nb">id</span><span class="o">=</span>2, <span class="nv">title</span><span class="o">=</span>Post one, <span class="nv">content</span><span class="o">=</span>The content of Post one, <span class="nv">createdDate</span><span class="o">=</span>2020-11-08T10:22:24.554356100, <span class="nv">updatedDate</span><span class="o">=</span>2020-11-08T10:22:24.554356100, <span class="nv">createdBy</span><span class="o">=</span>imdadareeph, <span class="nv">updatedBy</span><span class="o">=</span>imdadareeph<span class="o">))</span>
2020-11-08 10:22:26.661  INFO 16856 <span class="nt">---</span> <span class="o">[</span>o4jDriverIO-2-2] com.example.demo.DataInitializer         : found post: Post<span class="o">(</span><span class="nb">id</span><span class="o">=</span>2, <span class="nv">title</span><span class="o">=</span>Post one, <span class="nv">content</span><span class="o">=</span>The content of Post one, <span class="nv">createdDate</span><span class="o">=</span>2020-11-08T10:22:24.554356100, <span class="nv">updatedDate</span><span class="o">=</span>2020-11-08T10:22:24.554356100, <span class="nv">createdBy</span><span class="o">=</span>imdadareeph, <span class="nv">updatedBy</span><span class="o">=</span>imdadareeph<span class="o">)</span>
2020-11-08 10:22:26.661  INFO 16856 <span class="nt">---</span> <span class="o">[</span>o4jDriverIO-2-2] <span class="o">[</span>Initializing data]                      : onNext<span class="o">(</span>Post<span class="o">(</span><span class="nb">id</span><span class="o">=</span>3, <span class="nv">title</span><span class="o">=</span>Post two, <span class="nv">content</span><span class="o">=</span>The content of Post two, <span class="nv">createdDate</span><span class="o">=</span>2020-11-08T10:22:24.562356700, <span class="nv">updatedDate</span><span class="o">=</span>2020-11-08T10:22:24.562356700, <span class="nv">createdBy</span><span class="o">=</span>imdadareeph, <span class="nv">updatedBy</span><span class="o">=</span>imdadareeph<span class="o">))</span>
2020-11-08 10:22:26.661  INFO 16856 <span class="nt">---</span> <span class="o">[</span>o4jDriverIO-2-2] com.example.demo.DataInitializer         : found post: Post<span class="o">(</span><span class="nb">id</span><span class="o">=</span>3, <span class="nv">title</span><span class="o">=</span>Post two, <span class="nv">content</span><span class="o">=</span>The content of Post two, <span class="nv">createdDate</span><span class="o">=</span>2020-11-08T10:22:24.562356700, <span class="nv">updatedDate</span><span class="o">=</span>2020-11-08T10:22:24.562356700, <span class="nv">createdBy</span><span class="o">=</span>imdadareeph, <span class="nv">updatedBy</span><span class="o">=</span>imdadareeph<span class="o">)</span>
</code></pre></div></div> <p>You can also verify it via <code class="language-plaintext highlighter-rouge">curl</code> .</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> curl http://localhost:8080/posts
<span class="o">[{</span><span class="s2">"id"</span>:2,<span class="s2">"title"</span>:<span class="s2">"Post one"</span>,<span class="s2">"content"</span>:<span class="s2">"The content of Post one"</span>,<span class="s2">"createdDate"</span>:<span class="s2">"2020-11-08T10:22:24.5543561"</span>,<span class="s2">"updatedDate"</span>:<span class="s2">"2020-11-08T10:22:24.5543561"</span>,<span class="s2">"createdBy"</span>:<span class="s2">"imdadareeph"</span>,<span class="s2">"updatedBy"</span>:<span class="s2">"imdadareeph"</span><span class="o">}</span>,<span class="o">{</span><span class="s2">"id"</span>:3,<span class="s2">"title"</span>:<span class="s2">"Post two"</span>,<span class="s2">"content"</span>:<span class="s2">"The content of Post two"</span>,<span class="s2">"createdDate"</span>:<span class="s2">"2020-11-08T10:22:24.5623567"</span>,<span class="s2">"updatedDate"</span>:<span class="s2">"2020-11-08T10:22:24.5623567"</span>,<span class="s2">"createdBy"</span>:<span class="s2">"imdadareeph"</span>,<span class="s2">"updatedBy"</span>:<span class="s2">"imdadareeph"</span><span class="o">}]</span>
</code></pre></div></div> <p>For the complete codes, check <a href="https://github.com/imdadareeph/reactive-spring/blob/master/boot-data-neo4j" rel="external nofollow noopener" target="_blank">reactive-spring/boot-data-neo4j</a>.</p> <h2 id="testing">Testing</h2> <p>Since version 1.4, Spring Boot provided a new test harness so-called <strong>test slice</strong> to test features easier than previous version, which included a series of <code class="language-plaintext highlighter-rouge">AutoConfigureXXX</code> to allow developers to test desired features in an isolated environment.</p> <p>For example, adding a test scoped H2 dependency into your project and annotating your test class with <code class="language-plaintext highlighter-rouge">@DataJpaTest</code>, you can test your <code class="language-plaintext highlighter-rouge">Repository</code> class against an embedded H2 instead of the real runtime database. With the <code class="language-plaintext highlighter-rouge">@DataJpaTest</code>, Spring test context only loads the essential configuration for testing JPA facilities, no need to load the all configuration for the whole application .</p> <p>For Spring Data Neo4j, Spring Boot also provides a <code class="language-plaintext highlighter-rouge">@DataNeo4jTest</code> for testing Neo4j facilities, but unfortunately it does not include an utility to start up an embedded Neoj4 database for your tests. There are some solutions to overcome this barrier.</p> <ul> <li>Neo4j provides a test harness which provides APIs to start and stop an embedded Neo4j server by programmatic approach.</li> <li> <a href="https://www.testcontainers.org" rel="external nofollow noopener" target="_blank">Testcontainers</a> is a generic solution to run Docker containers for the testing framework, it is easy to start a Neo4j database in a Docker container when testing Spring Data Neo4j repositories.</li> </ul> <h3 id="test-with-neo4j-test-harness">Test with Neo4j test harness</h3> <p>Add the following dependency into your <em>pom.xml</em>.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.neo4j.test<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>neo4j-harness<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${neo4j-harness.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>slf4j-nop<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
    <span class="nt">&lt;/exclusions&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div> <p>In your test, add the following codes to serve a running Neo4j server when running tests.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DataNeo4jTest</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="nc">Propagation</span><span class="o">.</span><span class="na">NEVER</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepositoryWithNeo4jHarnessTest</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Neo4j</span> <span class="n">embeddedDatabaseServer</span><span class="o">;</span>

    <span class="nd">@BeforeAll</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">initializeNeo4j</span><span class="o">()</span> <span class="o">{</span>

        <span class="n">embeddedDatabaseServer</span> <span class="o">=</span> <span class="nc">Neo4jBuilders</span><span class="o">.</span><span class="na">newInProcessBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withDisabledServer</span><span class="o">()</span><span class="c1">//disable http server</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">neo4jProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.uri"</span><span class="o">,</span> <span class="nl">embeddedDatabaseServer:</span><span class="o">:</span><span class="n">boltURI</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.authentication.username"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"neo4j"</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.authentication.password"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@AfterAll</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">stopNeo4j</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">embeddedDatabaseServer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div> <p>In the above codes,</p> <ul> <li>We use the JUnit 5 lifecycle hooks, such as <code class="language-plaintext highlighter-rouge">beforeAll</code> and <code class="language-plaintext highlighter-rouge">afterAll</code> to start and stop an embedded Neo4j server.</li> <li>Use a static method annotated with <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code> to bind the Neo4j properties to the Spring test context.</li> </ul> <p>Now you can add tests as general.</p> <h3 id="test-with-testcontainers">Test with Testcontainers</h3> <p>Testcontainers provides a simple programmatic API abstraction for you to bootstrap a Docker container in your testing codes.</p> <p>Testcontainers is available in the official <a href="https://start.spring.io" rel="external nofollow noopener" target="_blank">Spring initializr</a>. You can add <em>TestContainers</em> as dependencies when generating new project using <a href="https://start.spring.io" rel="external nofollow noopener" target="_blank">Spring initializr</a>.</p> <p>Or add the following dependencies into your <em>pom.xml</em> manually.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit-jupiter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>neo4j<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div> <p>And import the testcontainers BOM in the <code class="language-plaintext highlighter-rouge">depedencyManagement</code>section.</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.testcontainers<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>testcontainers-bom<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${testcontainers.version}<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div> <p>In the above code,</p> <ul> <li>The <code class="language-plaintext highlighter-rouge">junit-jupiter</code> artifact is used to integrate <em>TestContainers</em> with JUnit 5 platform.</li> <li>The <code class="language-plaintext highlighter-rouge">neo4j</code> artifact provides APIs to compose a Neo4j Docker container.</li> </ul> <p>Create a test for <code class="language-plaintext highlighter-rouge">PostRepository</code>.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>
<span class="c1">//@DataNeo4jTest</span>
<span class="nd">@Testcontainers</span>
<span class="nd">@Slf4j</span>
<span class="nd">@TestInstance</span><span class="o">(</span><span class="nc">TestInstance</span><span class="o">.</span><span class="na">Lifecycle</span><span class="o">.</span><span class="na">PER_METHOD</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepositoryWithTestContainersTest</span> <span class="o">{</span>

    <span class="nd">@Container</span>
    <span class="kd">static</span> <span class="nc">Neo4jContainer</span><span class="o">&lt;?&gt;</span> <span class="n">neo4jContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Neo4jContainer</span><span class="o">&lt;&gt;(</span><span class="s">"neo4j:4.0"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">withStartupTimeout</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMinutes</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span>

    <span class="nd">@DynamicPropertySource</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">neo4jProperties</span><span class="o">(</span><span class="nc">DynamicPropertyRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.uri"</span><span class="o">,</span> <span class="nl">neo4jContainer:</span><span class="o">:</span><span class="n">getBoltUrl</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.authentication.username"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="s">"neo4j"</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"spring.neo4j.authentication.password"</span><span class="o">,</span> <span class="nl">neo4jContainer:</span><span class="o">:</span><span class="n">getAdminPassword</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PostRepository</span> <span class="n">posts</span><span class="o">;</span>

    <span class="nd">@BeforeEach</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"running setup.....,"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">thenMany</span><span class="o">(</span><span class="n">testSaveMethod</span><span class="o">())</span>
                <span class="o">.</span><span class="na">log</span><span class="o">()</span>
                <span class="o">.</span><span class="na">thenMany</span><span class="o">(</span><span class="n">testFoundMethod</span><span class="o">())</span>
                <span class="o">.</span><span class="na">log</span><span class="o">()</span>
                <span class="o">.</span><span class="na">blockLast</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">5</span><span class="o">));</span><span class="c1">// to make the tests work</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">testSaveMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">var</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">,</span> <span class="s">"Post two"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">title</span> <span class="o">-&gt;</span> <span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">title</span><span class="o">(</span><span class="n">title</span><span class="o">).</span><span class="na">content</span><span class="o">(</span><span class="s">"The content of "</span> <span class="o">+</span> <span class="n">title</span><span class="o">).</span><span class="na">build</span><span class="o">())</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        <span class="k">return</span> <span class="nc">Flux</span><span class="o">.</span><span class="na">fromIterable</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
                <span class="o">.</span><span class="na">flatMap</span><span class="o">(</span><span class="n">it</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">it</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Flux</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">testFoundMethod</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">posts</span>
                <span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="nc">Example</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">title</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">).</span><span class="na">build</span><span class="o">()));</span>
    <span class="o">}</span>

    <span class="nd">@AfterEach</span>
    <span class="kt">void</span> <span class="nf">teardown</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testAllPosts</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">posts</span><span class="o">.</span><span class="na">findAll</span><span class="o">().</span><span class="na">sort</span><span class="o">(</span><span class="nc">Comparator</span><span class="o">.</span><span class="na">comparing</span><span class="o">(</span><span class="n">post</span> <span class="o">-&gt;</span> <span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="nl">StepVerifier:</span><span class="o">:</span><span class="n">create</span><span class="o">)</span>
                <span class="o">.</span><span class="na">consumeNextWith</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Post one"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">consumeNextWith</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">assertEquals</span><span class="o">(</span><span class="s">"Post two"</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">verifyComplete</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p>In the above codes,</p> <ul> <li>A test class is annotated with a general <code class="language-plaintext highlighter-rouge">@SpringBootTest</code> annotation(will load all configurations) or a <code class="language-plaintext highlighter-rouge">@DataNeo4jTest</code> annotation. When using <code class="language-plaintext highlighter-rouge">@DataNeo4jTest</code>, you have to add an extra <code class="language-plaintext highlighter-rouge">@Transactional(propagation = Propagation.NEVER)</code>, check <a href="https://github.com/spring-projects/spring-boot/issues/23630" rel="external nofollow noopener" target="_blank">spring-boot issue#23630</a> for more details.</li> <li>A <code class="language-plaintext highlighter-rouge">@Testcontainers</code> is added on the class level, thus the Testcontainers facilities will contribute the test lifecycle.</li> <li>A static <code class="language-plaintext highlighter-rouge">@Container</code> resource is defined, it will be initialized before the test execution.</li> <li>By default, JUnit 5 uses a <code class="language-plaintext highlighter-rouge">PER_METHOD</code> strategy to bootstrap a test, if you set a global <code class="language-plaintext highlighter-rouge">PER_CLASS</code> strategy in the <em>junit-platform.properties</em>, add a <code class="language-plaintext highlighter-rouge">@TestInstance(TestInstance.Lifecycle.PER_METHOD)</code> to override it.</li> <li>A static method annotated with <code class="language-plaintext highlighter-rouge">@DynamicPropertySource</code> is used to bind properties from the running Docker container to the Spring environmental variables before the test is running.</li> <li>You can inject your <code class="language-plaintext highlighter-rouge">Repository</code> beans, and the Neo4j specific <code class="language-plaintext highlighter-rouge">ReactiveNeo4jOperations</code>, <code class="language-plaintext highlighter-rouge">ReactiveNeo4jClient</code>, <code class="language-plaintext highlighter-rouge">Driver</code> beans etc. in a <code class="language-plaintext highlighter-rouge">@DataNeo4jTest</code> annotated test directly.</li> <li>Generally, you can add <code class="language-plaintext highlighter-rouge">@BeforeEach</code>, <code class="language-plaintext highlighter-rouge">@AfterEach</code> methods to hook the JUnit test lifecycle.</li> <li>In the <code class="language-plaintext highlighter-rouge">@Test</code> method, we usually utilizes reactor’s <code class="language-plaintext highlighter-rouge">StepVerifier</code> to assert the result.</li> </ul> <blockquote> <p>In the original <a href="(https://github.com/neo4j/sdn-rx/)">SDN Rx</a>, it provided a <code class="language-plaintext highlighter-rouge">@ReactiveDataNeo4jTest</code> for testing reactive applications, this annotation is not available in Spring Boot 2.4.</p> </blockquote> <p>Alternatively, you can create a <code class="language-plaintext highlighter-rouge">ApplicationContextInitializer</code> to start a Neo4j Docker container manually.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DataNeo4jTest</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span> <span class="o">=</span> <span class="nc">Propagation</span><span class="o">.</span><span class="na">NEVER</span><span class="o">)</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span><span class="n">initializers</span> <span class="o">=</span> <span class="nc">PostRepositoryTest</span><span class="o">.</span><span class="na">TestContainerInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepositoryTest</span> <span class="o">{</span>


    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TestContainerInitializer</span> <span class="kd">implements</span> <span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">ConfigurableApplicationContext</span><span class="o">&gt;</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">(</span><span class="nc">ConfigurableApplicationContext</span> <span class="n">configurableApplicationContext</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="nc">Neo4jContainer</span><span class="o">&lt;?&gt;</span> <span class="n">neo4jContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Neo4jContainer</span><span class="o">&lt;&gt;(</span><span class="s">"neo4j:4.0"</span><span class="o">).</span><span class="na">withoutAuthentication</span><span class="o">();</span>
            <span class="n">neo4jContainer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
            <span class="n">configurableApplicationContext</span>
                    <span class="o">.</span><span class="na">addApplicationListener</span><span class="o">((</span><span class="nc">ApplicationListener</span><span class="o">&lt;</span><span class="nc">ContextClosedEvent</span><span class="o">&gt;)</span> <span class="n">event</span> <span class="o">-&gt;</span> <span class="n">neo4jContainer</span><span class="o">.</span><span class="na">stop</span><span class="o">());</span>
            <span class="nc">TestPropertyValues</span>
                    <span class="o">.</span><span class="na">of</span><span class="o">(</span>
                            <span class="s">"spring.neo4j.uri="</span> <span class="o">+</span> <span class="n">neo4jContainer</span><span class="o">.</span><span class="na">getBoltUrl</span><span class="o">(),</span>
                            <span class="s">"spring.neo4j.authentication.username=neo4j"</span><span class="o">,</span>
                            <span class="s">"spring.neo4j.authentication.password="</span> <span class="o">+</span> <span class="n">neo4jContainer</span><span class="o">.</span><span class="na">getAdminPassword</span><span class="o">()</span>
                    <span class="o">)</span>
                    <span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">configurableApplicationContext</span><span class="o">.</span><span class="na">getEnvironment</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div> <p>In the above, we use a <code class="language-plaintext highlighter-rouge">ContextConfiguration</code> to apply the context initializers. In the real world application, you can extract <code class="language-plaintext highlighter-rouge">TestContainerInitializer</code> to a standalone class, and thus it is easy to reuse in any tests that requires a running Neo4j server instance.</p> <p>For the complete codes, check <a href="https://github.com/imdadareeph/reactive-spring/blob/master/boot-data-neo4j" rel="external nofollow noopener" target="_blank">reactive-spring/boot-data-neo4j</a>.</p> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Imdad Areeph. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/imdadareeph/docs" rel="external nofollow noopener" target="_blank">docs</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/docs/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/docs/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/docs/assets/js/no_defer.js"></script> <script defer src="/docs/assets/js/common.js"></script> <script defer src="/docs/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>